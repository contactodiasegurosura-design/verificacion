<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>DÃ­a Seguro SURA â€” Portal de VerificaciÃ³n</title>
<style>
  :root{
    --azul:#0057B8;
    --azul-2:#009EE0;
    --naranja:#F37021;
    --gris:#444;
    --card-bg: #ffffff;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family: "Segoe UI", Roboto, Arial, sans-serif;background:#f4f7fb;color:var(--gris)}
  header{background:linear-gradient(90deg,var(--azul),var(--azul-2));color:#fff;padding:14px;text-align:center;font-weight:700}
  main{max-width:980px;margin:20px auto;padding:18px}
  .top-row{display:flex;justify-content:space-between;gap:12px;align-items:center;flex-wrap:wrap;margin-bottom:12px}
  .search {flex:1;min-width:220px}
  .search input{width:100%;padding:10px;border-radius:8px;border:1px solid #e0e6ef;font-size:15px}
  .btn{background:linear-gradient(90deg,var(--azul),var(--azul-2));color:#fff;padding:10px 14px;border-radius:8px;border:0;cursor:pointer;font-weight:700}
  .btn.orange{background:var(--naranja)}
  .card{background:var(--card-bg);padding:16px;border-radius:12px;box-shadow:0 8px 24px rgba(0,0,0,0.06);margin-bottom:18px}
  table{width:100%;border-collapse:collapse}
  th,td{padding:10px;border-bottom:1px solid #eee;text-align:left}
  th{background:#f7f9fb}
  .estatus-cancelada{color:#b32b2b;font-weight:700}
  .estatus-proceso{color:#e07a00;font-weight:700}
  .form-row{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
  .form-row input{padding:10px;border-radius:8px;border:1px solid #e6eaf2;flex:1}
  .small{font-size:13px;color:#666}
  footer{text-align:center;color:#666;font-size:13px;margin-top:10px;padding-bottom:20px}

  /* Admin modal / panel */
  .admin-panel{position:fixed;right:18px;top:90px;width:360px;max-width:calc(100% - 40px);z-index:999;display:none}
  .admin-card{background:#fff;padding:14px;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,0.12)}
  .admin-card h3{margin:0 0 8px 0}
  .admin-actions{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  .admin-note{font-size:12px;color:#666;margin-top:8px}

  /* WhatsApp flotante */
  .wa-float{position:fixed;right:18px;bottom:18px;z-index:9999}
  .wa-btn{display:flex;align-items:center;gap:10px;background:#25D366;color:#fff;padding:12px 16px;border-radius:50px;text-decoration:none;font-weight:700;box-shadow:0 6px 18px rgba(0,0,0,0.18)}

  @media(max-width:720px){
    .top-row{flex-direction:column;align-items:stretch}
    .admin-panel{right:12px;left:12px;top:auto;bottom:92px}
  }
</style>
</head>
<body>

<header>ðŸ”’ DÃ­a Seguro SURA â€” Portal de VerificaciÃ³n y Estatus de PÃ³liza Multiplataforma</header>

<main>
  <div class="top-row">
    <div class="search card">
      <input id="searchInput" placeholder="Buscar por nombre o nÃºmero de pÃ³liza..." />
    </div>

    <div style="display:flex;gap:8px;align-items:center">
      <button id="adminBtn" class="btn">Admin</button>
      <button id="showAll" class="btn">Mostrar todo</button>
    </div>
  </div>

  <div class="card">
    <strong>PÃ³lizas registradas</strong>
    <table aria-live="poliza-list">
      <thead>
        <tr><th>Nombre</th><th>NÂ° PÃ³liza</th><th>Plan</th><th>Estatus</th><th>Fecha</th><th></th></tr>
      </thead>
      <tbody id="tableBody"></tbody>
    </table>
    <div id="noData" class="small" style="display:none;margin-top:10px">No hay pÃ³lizas registradas.</div>
  </div>

  <div class="card">
    <h3>Â¿Necesitas ayuda o una cotizaciÃ³n?</h3>
    <p class="small">EnvÃ­a un mensaje por WhatsApp y un asesor te responderÃ¡.</p>
    <div style="display:flex;gap:8px;flex-wrap:wrap">
      <input id="quote-name" placeholder="Tu nombre" style="padding:10px;border-radius:8px;border:1px solid #e6eaf2;flex:1">
      <input id="quote-pol" placeholder="NÂ° pÃ³liza (opcional)" style="padding:10px;border-radius:8px;border:1px solid #e6eaf2;width:160px">
      <button id="quoteBtn" class="btn orange">Contactar por WhatsApp</button>
    </div>
  </div>

  <footer>Â© 2025 DÃ­a Seguro SURA â€” Soporte: contacto@diasegurosura.com</footer>
</main>

<!-- Admin panel (oculto hasta login) -->
<div class="admin-panel" id="adminPanel" aria-hidden="true">
  <div class="admin-card">
    <h3>Panel Admin</h3>
    <div id="adminContent">
      <!-- Login form will appear here -->
    </div>
    <div class="admin-note">Nota: el control admin estÃ¡ protegido en este navegador. No es un sistema de autenticaciÃ³n de servidor.</div>
  </div>
</div>

<!-- WhatsApp flotante -->
<div class="wa-float">
  <a class="wa-btn" id="waBtn" href="#" target="_blank" rel="noopener">
    ðŸ’¬ Consultar / Cotizar
  </a>
</div>

<script>
/* ========== CONFIG ========== */
const WHATSAPP = "525528042994"; // tu nÃºmero (sin +)
const LOCAL_KEY = "polizas_diaseguro_v2";
const ADMIN_HASH_KEY = "admin_hash_diaseguro_v2";

/* ========== UTIL: SHA-256 hashing (SubtleCrypto) ========== */
async function sha256hex(text){
  const enc = new TextEncoder();
  const data = enc.encode(text);
  const hash = await crypto.subtle.digest('SHA-256', data);
  const arr = Array.from(new Uint8Array(hash));
  return arr.map(b => b.toString(16).padStart(2,'0')).join('');
}

/* ========== Polizas: cargar / guardar ========== */
function loadPolizas(){
  try{
    const raw = localStorage.getItem(LOCAL_KEY);
    if(!raw) {
      // datos iniciales (tus 3 pÃ³lizas CANCELADAS)
      const init = [
        { nombre:"Eduardo Antonio Cordero Vargas", numero:"19030", plan:"DÃ­a Seguro SURA Platino Plus", estatus:"Cancelada", fecha:"2025-11-06" },
        { nombre:"Oscar Bryan Ruiz Chuc", numero:"7554", plan:"DÃ­a Seguro SURA Platino Plus", estatus:"Cancelada", fecha:"2025-11-06" },
        { nombre:"Jonathan Geovanni Orine Celis", numero:"7555", plan:"DÃ­a Seguro SURA Platino Plus", estatus:"Cancelada", fecha:"2025-11-06" }
      ];
      localStorage.setItem(LOCAL_KEY, JSON.stringify(init));
      return init;
    }
    return JSON.parse(raw);
  }catch(e){
    console.warn(e);
    return [];
  }
}
function savePolizas(arr){ localStorage.setItem(LOCAL_KEY, JSON.stringify(arr)); }

/* ========== RENDER ========== */
let polizas = loadPolizas();
const tableBody = document.getElementById('tableBody');
const noData = document.getElementById('noData');

function render(list){
  tableBody.innerHTML = "";
  if(!list || list.length === 0){
    noData.style.display = "block";
    return;
  }
  noData.style.display = "none";
  list.forEach((p,idx)=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${escapeHtml(p.nombre)}</td>
      <td>${escapeHtml(p.numero)}</td>
      <td>${escapeHtml(p.plan)}</td>
      <td class="${p.estatus === 'Cancelada' ? 'estatus-cancelada' : 'estatus-proceso'}">${escapeHtml(p.estatus)}</td>
      <td>${escapeHtml(p.fecha||'')}</td>
      <td style="text-align:right">
        <button data-idx="${idx}" class="btn" style="background:#eee;color:#333;padding:6px 8px;border-radius:6px;border:0">Ver</button>
      </td>
    `;
    tableBody.appendChild(tr);
  });
}

/* ========== SEARCH ========== */
const searchInput = document.getElementById('searchInput');
searchInput.addEventListener('input', ()=> {
  const q = searchInput.value.trim().toLowerCase();
  if(!q){ render(polizas); return; }
  const filtered = polizas.filter(p => p.nombre.toLowerCase().includes(q) || p.numero.includes(q));
  render(filtered);
});
document.getElementById('showAll').addEventListener('click', ()=>{ searchInput.value=''; render(polizas); });

/* ========== VIEW BUTTON (delegation) ========== */
tableBody.addEventListener('click', (e)=>{
  const b = e.target.closest('button');
  if(!b) return;
  const idx = b.getAttribute('data-idx');
  const p = polizas[idx];
  if(!p) return;
  alert(`PÃ³liza ${p.numero}\nNombre: ${p.nombre}\nPlan: ${p.plan}\nEstatus: ${p.estatus}\nFecha: ${p.fecha||'--'}`);
});

/* ========== ADMIN: Login / panel UI ========== */
const adminBtn = document.getElementById('adminBtn');
const adminPanel = document.getElementById('adminPanel');
const adminContent = document.getElementById('adminContent');

async function showAdminLogin(){
  adminPanel.style.display = 'block';
  adminContent.innerHTML = `
    <div>
      <label style="font-weight:700">Acceso Administrador</label>
      <div style="margin-top:8px">
        <input id="adm-pass" placeholder="ContraseÃ±a admin" style="width:100%;padding:8px;border-radius:6px;border:1px solid #e6eaf2">
      </div>
      <div style="margin-top:8px;display:flex;gap:8px">
        <button id="adm-login" class="btn">Entrar</button>
        <button id="adm-set" class="btn" style="background:#666">Crear/Reset</button>
        <button id="adm-close" class="btn" style="background:#ccc;color:#111">Cerrar</button>
      </div>
      <div class="admin-note" style="margin-top:8px">Si nunca configuraste contraseÃ±a, usa "Crear/Reset" para definir una. (ProtecciÃ³n local en este navegador).</div>
    </div>
  `;
  document.getElementById('adm-close').addEventListener('click', ()=> adminPanel.style.display='none');
  document.getElementById('adm-set').addEventListener('click', async ()=>{
    const p = prompt('Nueva contraseÃ±a admin (guÃ¡rdala en un lugar seguro):');
    if(!p) return alert('No se guardÃ³ contraseÃ±a.');
    const h = await sha256hex(p);
    localStorage.setItem(ADMIN_HASH_KEY, h);
    alert('ContraseÃ±a admin creada. Ahora usa Entrar con esa contraseÃ±a.');
  });
  document.getElementById('adm-login').addEventListener('click', async ()=>{
    const pass = document.getElementById('adm-pass').value||'';
    if(!pass) return alert('Escribe la contraseÃ±a.');
    const stored = localStorage.getItem(ADMIN_HASH_KEY);
    if(!stored) return alert('No hay contraseÃ±a configurada. Usa Crear/Reset.');
    const h = await sha256hex(pass);
    if(h === stored){
      showAdminPanel();
    } else {
      alert('ContraseÃ±a incorrecta.');
    }
  });
}

function showAdminPanel(){
  adminContent.innerHTML = `
    <div>
      <h3>Administrar PÃ³lizas</h3>
      <div style="font-size:13px;color:#666;margin-bottom:8px">Agregar nueva pÃ³liza (se guardarÃ¡ en este navegador)</div>
      <div class="form-row">
        <input id="adm-name" placeholder="Nombre completo">
        <input id="adm-num" placeholder="NÃºmero de pÃ³liza" style="width:140px">
        <input id="adm-plan" placeholder="Plan" value="DÃ­a Seguro SURA Platino Plus">
        <input id="adm-fecha" placeholder="Fecha (YYYY-MM-DD)" style="width:140px">
      </div>
      <div style="margin-top:8px;display:flex;gap:8px">
        <button id="adm-add" class="btn">Agregar (En proceso de pago)</button>
        <button id="adm-clear" class="btn" style="background:#ccc;color:#111">Cerrar</button>
      </div>
      <hr style="margin:10px 0">
      <div style="font-weight:700;margin-bottom:6px">Lista (admin)</div>
      <div id="adm-list" style="max-height:200px;overflow:auto"></div>
      <div style="margin-top:8px;display:flex;gap:8px">
        <button id="adm-logout" class="btn" style="background:#b32b2b">Salir Admin</button>
      </div>
    </div>
  `;
  document.getElementById('adm-clear').addEventListener('click', ()=> adminPanel.style.display='none');
  document.getElementById('adm-logout').addEventListener('click', ()=> { adminPanel.style.display='none'; });
  document.getElementById('adm-add').addEventListener('click', ()=>{
    const name = document.getElementById('adm-name').value.trim();
    const num = document.getElementById('adm-num').value.trim();
    const plan = document.getElementById('adm-plan').value.trim() || 'DÃ­a Seguro SURA Platino Plus';
    const fecha = document.getElementById('adm-fecha').value.trim() || new Date().toISOString().slice(0,10);
    if(!name || !num) return alert('Completa nombre y nÃºmero.');
    // aÃ±adir como En proceso de pago
    polizas.unshift({ nombre:name, numero:num, plan:plan, estatus:'En proceso de pago para activar', fecha:fecha });
    savePolizas(polizas);
    render(polizas);
    updateAdminList();
    // limpiar inputs
    document.getElementById('adm-name').value=''; document.getElementById('adm-num').value=''; document.getElementById('adm-fecha').value='';
    alert('PÃ³liza agregada con estatus "En proceso de pago para activar".');
  });
  updateAdminList();
}

function updateAdminList(){
  const box = document.getElementById('adm-list');
  box.innerHTML = '';
  polizas.forEach((p, i)=>{
    const div = document.createElement('div');
    div.style.display='flex'; div.style.justifyContent='space-between'; div.style.alignItems='center'; div.style.padding='6px 0';
    div.innerHTML = `<div style="font-size:13px">${escapeHtml(p.numero)} â€” ${escapeHtml(p.nombre)} <span style="color:#666;font-size:12px">(${escapeHtml(p.estatus)})</span></div>
      <div style="display:flex;gap:6px">
        <button data-i="${i}" class="btn" style="background:#dddddd;color:#111;padding:6px 8px;border-radius:6px">Eliminar</button>
        <button data-edit="${i}" class="btn" style="background:#ffc107;color:#111;padding:6px 8px;border-radius:6px">Editar</button>
      </div>`;
    box.appendChild(div);
  });
  // attach handlers
  box.querySelectorAll('button[data-i]').forEach(b=>{
    b.addEventListener('click', ()=>{
      const i = Number(b.getAttribute('data-i'));
      if(!confirm('Eliminar esta pÃ³liza?')) return;
      polizas.splice(i,1);
      savePolizas(polizas);
      render(polizas);
      updateAdminList();
    });
  });
  box.querySelectorAll('button[data-edit]').forEach(b=>{
    b.addEventListener('click', ()=>{
      const i = Number(b.getAttribute('data-edit'));
      const p = polizas[i];
      const newName = prompt('Editar nombre:', p.nombre);
      if(newName === null) return;
      const newNum = prompt('Editar nÃºmero:', p.numero);
      if(newNum === null) return;
      const newPlan = prompt('Editar plan:', p.plan);
      if(newPlan === null) return;
      const newStatus = prompt('Editar estatus:', p.estatus);
      if(newStatus === null) return;
      const newFecha = prompt('Editar fecha (YYYY-MM-DD):', p.fecha||'');
      if(newFecha === null) return;
      polizas[i] = { nombre:newName, numero:newNum, plan:newPlan, estatus:newStatus, fecha:newFecha };
      savePolizas(polizas);
      render(polizas);
      updateAdminList();
    });
  });
}

/* ========== QUOTE / WhatsApp ========== */
document.getElementById('quoteBtn').addEventListener('click', ()=>{
  const name = document.getElementById('quote-name').value.trim() || '---';
  const pol = document.getElementById('quote-pol').value.trim() || '---';
  const text = `Hola, soy ${name}. Solicito informaciÃ³n/cotizaciÃ³n para la pÃ³liza: ${pol}`;
  const url = `https://wa.me/${WHATSAPP}?text=${encodeURIComponent(text)}`;
  window.open(url, '_blank');
});
document.getElementById('waBtn').setAttribute('href', `https://wa.me/${WHATSAPP}?text=${encodeURIComponent('Hola, necesito asistencia con una pÃ³liza.')}`);

/* ========== ADMIN: button open ========== */
adminBtn.addEventListener('click', ()=> showAdminLogin());

/* ========== INIT ========== */
render(polizas);

/* ========== HELPERS ========== */
function escapeHtml(s){ return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

</script>
</body>
</html>
