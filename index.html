<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Consulta de P√≥lizas</title>
<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f6f8;
  margin: 0;
  padding: 20px;
}
h1 {
  text-align: center;
}
input, button {
  padding: 8px;
  margin: 4px;
}
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 15px;
}
th, td {
  border: 1px solid #ccc;
  padding: 8px;
  text-align: center;
}
th {
  background: #222;
  color: white;
}
.modal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.6);
}
.modal-content {
  background: white;
  width: 90%;
  max-width: 700px;
  margin: 40px auto;
  padding: 20px;
  border-radius: 8px;
}
.admin {
  background: #0a58ca;
  color: white;
}
.protegida {
  background: #eee;
}
</style>
</head>

<body>

<h1>Consulta de P√≥lizas</h1>

<input id="busqueda" placeholder="Buscar por n√∫mero o nombre">
<button onclick="consultar()">Consultar</button>

<table>
<thead>
<tr>
<th>P√≥liza</th>
<th>Nombre</th>
<th>Veh√≠culo</th>
<th>A√±o</th>
<th>Vigencia</th>
</tr>
</thead>
<tbody id="resultado"></tbody>
</table>

<!-- MODAL ADMIN -->
<div class="modal" id="modalAdmin">
  <div class="modal-content">
    <h2>Administraci√≥n de P√≥lizas</h2>

    <input id="a_poliza" placeholder="N√∫mero de p√≥liza">
    <input id="a_nombre" placeholder="Nombre">
    <input id="a_vehiculo" placeholder="Veh√≠culo">
    <input id="a_anio" placeholder="A√±o">
    <input id="a_vigencia" placeholder="Vigencia">

    <br>
    <button class="admin" onclick="guardarPoliza()">Guardar</button>
    <button onclick="cerrarAdmin()">Cerrar</button>

    <table>
      <thead>
        <tr>
          <th>P√≥liza</th>
          <th>Nombre</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody id="listaAdmin"></tbody>
    </table>
  </div>
</div>

<script>
let editIndex = null;

function obtenerPolizas() {
  return JSON.parse(localStorage.getItem("polizas")) || [
    { poliza: "0332", nombre: "P√≥liza Base", vehiculo: "-", anio: "-", vigencia: "Indefinida" },
    { poliza: "0360", nombre: "P√≥liza Base", vehiculo: "-", anio: "-", vigencia: "Indefinida" }
  ];
}

function guardarLocal(polizas) {
  localStorage.setItem("polizas", JSON.stringify(polizas));
}

function consultar() {
  const q = busqueda.value.toLowerCase();
  const polizas = obtenerPolizas();
  resultado.innerHTML = "";

  polizas.filter(p =>
    p.poliza.includes(q) || p.nombre.toLowerCase().includes(q)
  ).forEach(p => {
    resultado.innerHTML += `
      <tr>
        <td>${p.poliza}</td>
        <td>${p.nombre}</td>
        <td>${p.vehiculo}</td>
        <td>${p.anio}</td>
        <td>${p.vigencia}</td>
      </tr>`;
  });
}

function abrirAdmin() {
  modalAdmin.style.display = "block";
  cargarAdmin();
}

function cerrarAdmin() {
  modalAdmin.style.display = "none";
  limpiarFormulario();
}

function cargarAdmin() {
  const polizas = obtenerPolizas();
  listaAdmin.innerHTML = "";

  polizas.forEach((p, i) => {
    const protegida = p.poliza === "0332" || p.poliza === "0360";
    listaAdmin.innerHTML += `
      <tr class="${protegida ? 'protegida' : ''}">
        <td>${p.poliza}</td>
        <td>${p.nombre}</td>
        <td>
          ${protegida ? 'Protegida' : `
          <button onclick="editarPoliza(${i})">‚úèÔ∏è</button>
          <button onclick="eliminarPoliza(${i})">üóëÔ∏è</button>`}
        </td>
      </tr>`;
  });
}

function guardarPoliza() {
  const polizas = obtenerPolizas();
  const nueva = {
    poliza: a_poliza.value,
    nombre: a_nombre.value,
    vehiculo: a_vehiculo.value,
    anio: a_anio.value,
    vigencia: a_vigencia.value
  };

  if (editIndex !== null) {
    polizas[editIndex] = nueva;
    editIndex = null;
  } else {
    polizas.push(nueva);
  }

  guardarLocal(polizas);
  limpiarFormulario();
  cargarAdmin();
}

function editarPoliza(i) {
  const p = obtenerPolizas()[i];
  editIndex = i;

  a_poliza.value = p.poliza;
  a_nombre.value = p.nombre;
  a_vehiculo.value = p.vehiculo;
  a_anio.value = p.anio;
  a_vigencia.value = p.vigencia;
}

function eliminarPoliza(i) {
  const polizas = obtenerPolizas();
  polizas.splice(i, 1);
  guardarLocal(polizas);
  cargarAdmin();
}

function limpiarFormulario() {
  editIndex = null;
  a_poliza.value = "";
  a_nombre.value = "";
  a_vehiculo.value = "";
  a_anio.value = "";
  a_vigencia.value = "";
}

document.addEventListener("keydown", e => {
  if (e.ctrlKey && e.key.toLowerCase() === "d") {
    const pass = prompt("Contrase√±a administrativa:");
    if (pass === "moreno476") abrirAdmin();
    else alert("Contrase√±a incorrecta");
  }
});
</script>

</body>
</html>
